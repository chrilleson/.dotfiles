- defaults:
    link:
      relink: true
      create: true

- clean: ['~']

# Create XDG directories on Linux/macOS
- shell:
  - description: Create XDG directories
    command: |
      if [ "$(uname)" != "Windows_NT" ]; then
        mkdir -p ~/.config ~/.local/{bin,share,state} ~/.cache
      fi
    stdout: true
    stderr: true
    quiet: true

# Symlink configurations
- link:
    # Nushell config (cross-platform)
    ~/.config/nushell:
      path: windows/nushell
      create: true

    # Git config (cross-platform)
    ~/.gitconfig:
      path: shared/git/gitconfig
    ~/.gitignore:
      path: shared/git/gitignore_global

    # Starship (cross-platform prompt)
    ~/.config/starship.toml:
      path: shared/starship/starship.toml
      if: '[ -d ~/.config ] || [ "$(uname)" = "Windows_NT" ]'

    # Neovim (cross-platform)
    ~/.config/nvim:
      path: shared/nvim
      create: true

    # WezTerm (macOS/Windows only â€” Linux uses Ghostty)
    ~/.wezterm.lua:
      path: shared/wezterm/wezterm.lua
      if: '[ "$(uname)" = "Darwin" ] || [ "$(uname)" = "Windows_NT" ]'

    # VS Code (platform-aware)
    ~/.config/Code/User/settings.json:
      path: windows/vscode/settings.json
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    ~/.config/Code/User/keybindings.json:
      path: windows/vscode/keybindings.json
      if: '[ "$(uname)" = "Linux" ]'
      create: true

    # Node configs (cross-platform)
    ~/.npmrc:
      path: shared/node/.npmrc
      if: '[ -f shared/node/.npmrc ]'
    ~/.eslintrc.json:
      path: shared/node/eslintrc.json
      if: '[ -f shared/node/eslintrc.json ]'
    ~/.prettierrc.json:
      path: shared/node/.prettierrc
      if: '[ -f shared/node/.prettierrc ]'

# Fish shell (Linux)
- link:
    ~/.config/fish/config.fish:
      path: linux/fish/config.fish
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    ~/.config/fish/conf.d/starship.fish:
      path: linux/fish/conf.d/starship.fish
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    ~/.config/fish/conf.d/fnm.fish:
      path: linux/fish/conf.d/fnm.fish
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    ~/.config/fish/conf.d/zoxide.fish:
      path: linux/fish/conf.d/zoxide.fish
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    ~/.config/fish/conf.d/fzf.fish:
      path: linux/fish/conf.d/fzf.fish
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    ~/.config/fish/functions/dev.fish:
      path: linux/fish/functions/dev.fish
      if: '[ "$(uname)" = "Linux" ]'
      create: true

# Ghostty (Linux)
- link:
    ~/.config/ghostty/config:
      path: linux/ghostty/config
      if: '[ "$(uname)" = "Linux" ]'
      create: true

# Tmux (Linux)
- link:
    ~/.config/tmux/tmux.conf:
      path: linux/tmux/tmux.conf
      if: '[ "$(uname)" = "Linux" ]'
      create: true

# Platform-specific scripts
- link:
    ~/.local/bin/opencode:
      path: shared/opencode/opencode
      if: '[ "$(uname)" = "Linux" ] || [ "$(uname)" = "Darwin" ]'

# Create local git config if it doesn't exist
- shell:
  - description: Create local gitconfig
    command: |
      if [ ! -f ~/.gitconfig-local ]; then
        cp shared/git/gitconfig-local.example ~/.gitconfig-local
        echo "Created ~/.gitconfig-local - please edit with your details"
      fi
    stdout: true
    stderr: true
