- defaults:
    link:
      relink: true
      create: true

- clean: ['~']

# Create XDG directories on Linux/macOS
- shell:
  - description: Create XDG directories
    command: |
      if [ "$(uname)" != "Windows_NT" ]; then
        mkdir -p ~/.config ~/.local/{bin,share,state} ~/.cache
      fi
    stdout: true
    stderr: true
    quiet: true

# Symlink configurations
- link:
    # Nushell config (cross-platform)
    ~/.config/nushell:
      path: nushell
      create: true
    
    # Git config (cross-platform)
    ~/.gitconfig:
      path: git/gitconfig
    ~/.gitignore:
      path: git/gitignore
    
    # Starship (cross-platform prompt)
    ~/.config/starship.toml:
      path: starship/starship.toml
      if: '[ -d ~/.config ] || [ "$(uname)" = "Windows_NT" ]'
    
    # Neovim (cross-platform)
    ~/.config/nvim:
      path: nvim
      create: true
    
    # WezTerm (platform-specific location)
    ~/.wezterm.lua:
      path: wezterm/wezterm.lua
      if: '[ "$(uname)" = "Darwin" ] || [ "$(uname)" = "Windows_NT" ]'
    ~/.config/wezterm:
      path: wezterm
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    
    # VS Code (platform-aware)
    ~/.config/Code/User/settings.json:
      path: vscode/settings.json
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    ~/.config/Code/User/keybindings.json:
      path: vscode/keybindings.json
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    
    # Node configs (cross-platform)
    ~/.npmrc:
      path: node/npmrc
      if: '[ -f node/npmrc ]'
    ~/.eslintrc.json:
      path: node/eslintrc.json
      if: '[ -f node/eslintrc.json ]'
    ~/.prettierrc.json:
      path: node/prettierrc.json
      if: '[ -f node/prettierrc.json ]'

# Platform-specific scripts
- link:
    ~/.local/bin/opencode:
      path: opencode/opencode
      if: '[ "$(uname)" = "Linux" ] || [ "$(uname)" = "Darwin" ]'
    # Bash integration files (Linux)
    ~/.bashrc.d/00-env.sh:
      path: linux/.bashrc.d/00-env.sh
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    ~/.bashrc.d/01-fnm.sh:
      path: linux/.bashrc.d/01-fnm.sh
      if: '[ "$(uname)" = "Linux" ]'
      create: true
    ~/.bashrc.d/02-tools.sh:
      path: linux/.bashrc.d/02-tools.sh
      if: '[ "$(uname)" = "Linux" ]'
      create: true

# Create local git config if it doesn't exist
- shell:
  - description: Create local gitconfig
    command: |
      if [ ! -f ~/.gitconfig-local ]; then
        cp git/gitconfig-local.example ~/.gitconfig-local
        echo "Created ~/.gitconfig-local - please edit with your details"
      fi
    stdout: true
    stderr: true
