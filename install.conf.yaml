- defaults:
    link:
      relink: true
      create: true
      force: true
    shell:
      stdout: true
      stderr: true

- clean:
    ~/:
      force: true
    ~/AppData/Roaming/nushell:
      force: true

- link:
    # Nushell
    ~/AppData/Roaming/nushell/config.nu: nushell/config.nu
    ~/AppData/Roaming/nushell/env.nu: nushell/env.nu
    ~/AppData/Roaming/nushell/scripts: nushell/scripts
    
    # WezTerm (from submodule)
    ~/.wezterm.lua: wezterm/wezterm.lua
    
    # Git
    ~/.gitconfig: git/gitconfig
    ~/.gitignore_global: git/gitignore_global

    # VS Code
    ~/AppData/Roaming/Code/User/settings.json: vscode/settings.json
    ~/AppData/Roaming/Code/User/keybindings.json: vscode/keybindings.json
    ~/AppData/Roaming/Code/User/snippets: vscode/snippets

    # Node/TypeScript
    ~/.npmrc: node/.npmrc
    .config/pnpm/rc: node/.pnpmrc
    ~/.eslintrc.json: node/eslintrc.json
    ~/.prettierrc: node/.prettierrc
    
    # Starship prompt
    ~/.config/starship.toml: starship/starship.toml
    
- create:
    - ~/AppData/Roaming/nushell
    - ~/AppData/Roaming/nushell/scripts
    - ~/.config
    - ~/.config/pnpm

- shell:
    - description: Installing Scoop packages
      command: |
        powershell
          -NoProfile
          -ExecutionPolicy Bypass
          -Command "
            if (!(Get-Command scoop -ErrorAction SilentlyContinue)) {
              Write-Host 'Scoop not installed. Install from https://scoop.sh'
            } else {
              scoop bucket add extras
              scoop bucket add nerd-fonts
              scoop install git delta fzf zoxide bat ripgrep fd jq starship wezterm nushell JetBrainsMono-NF fnm
            }"

    - description: Installing Node.js LTS via fnm
      command: |
        powershell
          -NoProfile
          -ExecutionPolicy Bypass
          -Command "
            fnm install --lts
            fnm use lts-latest
            fnm default lts-latest
          "

    - description: Installing global Node packages
      command: |
        powershell
          -NoProfile
          -ExecutionPolicy Bypass
          -Command "
            npm install -g typescript ts-node pnpm yarn eslint prettier @fsouza/prettierd
          "

    - description: Setting up Git
      command: git config --global core.excludesfile ~/.gitignore_global